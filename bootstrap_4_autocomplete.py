import sublime_plugin
import sublime

# The following 2 lines can be generated with "grunt sublime" in the main bootstrap code
bootstrap_classes = ["active","alert","alert-danger","alert-dismissible","alert-heading","alert-info","alert-link","alert-success","alert-warning","bg-danger","bg-faded","bg-info","bg-inverse","bg-primary","bg-success","bg-warning","blockquote","blockquote-footer","blockquote-reverse","breadcrumb","breadcrumb-item","bs-tether-element-attached-bottom","bs-tether-element-attached-left","bs-tether-element-attached-right","bs-tether-element-attached-top","btn","btn-block","btn-danger","btn-group","btn-group-lg","btn-group-sm","btn-group-vertical","btn-info","btn-lg","btn-link","btn-outline-danger","btn-outline-info","btn-outline-primary","btn-outline-secondary","btn-outline-success","btn-outline-warning","btn-primary","btn-secondary","btn-sm","btn-success","btn-toolbar","btn-warning","card","card-block","card-blockquote","card-columns","card-danger","card-deck","card-deck-wrapper","card-footer","card-group","card-header","card-header-pills","card-header-tabs","card-img","card-img-bottom","card-img-overlay","card-img-top","card-info","card-inverse","card-link","card-outline-danger","card-outline-info","card-outline-primary","card-outline-secondary","card-outline-success","card-outline-warning","card-primary","card-subtitle","card-success","card-text","card-title","card-warning","caret","carousel","carousel-caption","carousel-control","carousel-indicators","carousel-inner","carousel-item","checkbox","checkbox-inline","clearfix","close","col-form-label","col-form-label-lg","col-form-label-sm","col-form-legend","col-lg-1","col-lg-10","col-lg-11","col-lg-12","col-lg-2","col-lg-3","col-lg-4","col-lg-5","col-lg-6","col-lg-7","col-lg-8","col-lg-9","col-md-1","col-md-10","col-md-11","col-md-12","col-md-2","col-md-3","col-md-4","col-md-5","col-md-6","col-md-7","col-md-8","col-md-9","col-sm-1","col-sm-10","col-sm-11","col-sm-12","col-sm-2","col-sm-3","col-sm-4","col-sm-5","col-sm-6","col-sm-7","col-sm-8","col-sm-9","col-xl-1","col-xl-10","col-xl-11","col-xl-12","col-xl-2","col-xl-3","col-xl-4","col-xl-5","col-xl-6","col-xl-7","col-xl-8","col-xl-9","col-xs-1","col-xs-10","col-xs-11","col-xs-12","col-xs-2","col-xs-3","col-xs-4","col-xs-5","col-xs-6","col-xs-7","col-xs-8","col-xs-9","collapse","collapsing","container","container-fluid","custom-checkbox","custom-control","custom-control-description","custom-control-indicator","custom-control-input","custom-controls-stacked","custom-file","custom-file-control","custom-file-input","custom-radio","custom-select","custom-select-sm","d-block","d-inline","d-inline-block","disabled","display-1","display-2","display-3","display-4","dropdown","dropdown-backdrop","dropdown-divider","dropdown-header","dropdown-item","dropdown-menu","dropdown-menu-left","dropdown-menu-right","dropdown-toggle","dropdown-toggle-split","dropup","embed-responsive","embed-responsive-16by9","embed-responsive-1by1","embed-responsive-21by9","embed-responsive-4by3","embed-responsive-item","fade","figure","figure-caption","figure-img","focus","font-italic","font-weight-bold","font-weight-normal","form-check","form-check-inline","form-check-input","form-check-label","form-control","form-control-danger","form-control-feedback","form-control-file","form-control-label","form-control-lg","form-control-range","form-control-sm","form-control-static","form-control-success","form-control-warning","form-group","form-inline","form-text","h1","h2","h3","h4","h5","h6","has-danger","has-feedback","has-success","has-warning","hidden-lg-down","hidden-lg-up","hidden-md-down","hidden-md-up","hidden-print","hidden-sm-down","hidden-sm-up","hidden-xl-down","hidden-xl-up","hidden-xs-down","hidden-xs-up","icon-next","icon-prev","img-circle","img-fluid","img-rounded","img-thumbnail","in","initialism","input-group","input-group-addon","input-group-btn","input-group-lg","input-group-sm","invisible","jumbotron","jumbotron-fluid","jumbotron-hr","lead","left","list-group","list-group-flush","list-group-item","list-group-item-action","list-group-item-danger","list-group-item-heading","list-group-item-info","list-group-item-success","list-group-item-text","list-group-item-warning","list-inline","list-inline-item","list-unstyled","m-a-0","m-a-1","m-a-2","m-a-3","m-b-0","m-b-1","m-b-2","m-b-3","m-l-0","m-l-1","m-l-2","m-l-3","m-r-0","m-r-1","m-r-2","m-r-3","m-t-0","m-t-1","m-t-2","m-t-3","m-x-0","m-x-1","m-x-2","m-x-3","m-x-auto","m-y-0","m-y-1","m-y-2","m-y-3","mark","media","media-body","media-bottom","media-heading","media-left","media-list","media-middle","media-object","media-right","modal","modal-backdrop","modal-body","modal-content","modal-dialog","modal-footer","modal-header","modal-lg","modal-open","modal-scrollbar-measure","modal-sm","modal-title","nav","nav-inline","nav-item","nav-link","nav-pills","nav-stacked","nav-tabs","navbar","navbar-brand","navbar-dark","navbar-divider","navbar-fixed-bottom","navbar-fixed-top","navbar-full","navbar-light","navbar-nav","navbar-sticky-top","navbar-toggleable-md","navbar-toggleable-sm","navbar-toggleable-xs","navbar-toggler","next","offset-lg-0","offset-lg-1","offset-lg-10","offset-lg-11","offset-lg-2","offset-lg-3","offset-lg-4","offset-lg-5","offset-lg-6","offset-lg-7","offset-lg-8","offset-lg-9","offset-md-0","offset-md-1","offset-md-10","offset-md-11","offset-md-2","offset-md-3","offset-md-4","offset-md-5","offset-md-6","offset-md-7","offset-md-8","offset-md-9","offset-sm-0","offset-sm-1","offset-sm-10","offset-sm-11","offset-sm-2","offset-sm-3","offset-sm-4","offset-sm-5","offset-sm-6","offset-sm-7","offset-sm-8","offset-sm-9","offset-xl-0","offset-xl-1","offset-xl-10","offset-xl-11","offset-xl-2","offset-xl-3","offset-xl-4","offset-xl-5","offset-xl-6","offset-xl-7","offset-xl-8","offset-xl-9","offset-xs-1","offset-xs-10","offset-xs-11","offset-xs-2","offset-xs-3","offset-xs-4","offset-xs-5","offset-xs-6","offset-xs-7","offset-xs-8","offset-xs-9","open","p-a-0","p-a-1","p-a-2","p-a-3","p-b-0","p-b-1","p-b-2","p-b-3","p-l-0","p-l-1","p-l-2","p-l-3","p-r-0","p-r-1","p-r-2","p-r-3","p-t-0","p-t-1","p-t-2","p-t-3","p-x-0","p-x-1","p-x-2","p-x-3","p-y-0","p-y-1","p-y-2","p-y-3","page-item","page-link","pagination","pagination-lg","pagination-sm","popover","popover-arrow","popover-bottom","popover-content","popover-left","popover-right","popover-title","popover-top","pos-f-t","pre-scrollable","prev","progress","progress-animated","progress-bar","progress-bar-striped","progress-danger","progress-info","progress-striped","progress-success","progress-warning","pull-lg-0","pull-lg-1","pull-lg-10","pull-lg-11","pull-lg-12","pull-lg-2","pull-lg-3","pull-lg-4","pull-lg-5","pull-lg-6","pull-lg-7","pull-lg-8","pull-lg-9","pull-lg-left","pull-lg-none","pull-lg-right","pull-md-0","pull-md-1","pull-md-10","pull-md-11","pull-md-12","pull-md-2","pull-md-3","pull-md-4","pull-md-5","pull-md-6","pull-md-7","pull-md-8","pull-md-9","pull-md-left","pull-md-none","pull-md-right","pull-sm-0","pull-sm-1","pull-sm-10","pull-sm-11","pull-sm-12","pull-sm-2","pull-sm-3","pull-sm-4","pull-sm-5","pull-sm-6","pull-sm-7","pull-sm-8","pull-sm-9","pull-sm-left","pull-sm-none","pull-sm-right","pull-xl-0","pull-xl-1","pull-xl-10","pull-xl-11","pull-xl-12","pull-xl-2","pull-xl-3","pull-xl-4","pull-xl-5","pull-xl-6","pull-xl-7","pull-xl-8","pull-xl-9","pull-xl-left","pull-xl-none","pull-xl-right","pull-xs-0","pull-xs-1","pull-xs-10","pull-xs-11","pull-xs-12","pull-xs-2","pull-xs-3","pull-xs-4","pull-xs-5","pull-xs-6","pull-xs-7","pull-xs-8","pull-xs-9","pull-xs-left","pull-xs-none","pull-xs-right","push-lg-0","push-lg-1","push-lg-10","push-lg-11","push-lg-12","push-lg-2","push-lg-3","push-lg-4","push-lg-5","push-lg-6","push-lg-7","push-lg-8","push-lg-9","push-md-0","push-md-1","push-md-10","push-md-11","push-md-12","push-md-2","push-md-3","push-md-4","push-md-5","push-md-6","push-md-7","push-md-8","push-md-9","push-sm-0","push-sm-1","push-sm-10","push-sm-11","push-sm-12","push-sm-2","push-sm-3","push-sm-4","push-sm-5","push-sm-6","push-sm-7","push-sm-8","push-sm-9","push-xl-0","push-xl-1","push-xl-10","push-xl-11","push-xl-12","push-xl-2","push-xl-3","push-xl-4","push-xl-5","push-xl-6","push-xl-7","push-xl-8","push-xl-9","push-xs-0","push-xs-1","push-xs-10","push-xs-11","push-xs-12","push-xs-2","push-xs-3","push-xs-4","push-xs-5","push-xs-6","push-xs-7","push-xs-8","push-xs-9","radio","radio-inline","right","row","small","sr-only","sr-only-focusable","tab-content","tab-pane","table","table-active","table-bordered","table-danger","table-hover","table-info","table-inverse","table-reflow","table-responsive","table-sm","table-striped","table-success","table-warning","tag","tag-danger","tag-default","tag-info","tag-pill","tag-primary","tag-success","tag-warning","text-capitalize","text-danger","text-hide","text-info","text-justify","text-lg-center","text-lg-left","text-lg-right","text-lowercase","text-md-center","text-md-left","text-md-right","text-muted","text-nowrap","text-primary","text-sm-center","text-sm-left","text-sm-right","text-success","text-truncate","text-uppercase","text-warning","text-xl-center","text-xl-left","text-xl-right","text-xs-center","text-xs-left","text-xs-right","thead-default","thead-inverse","tooltip","tooltip-arrow","tooltip-bottom","tooltip-inner","tooltip-left","tooltip-right","tooltip-top","visible-print-block","visible-print-inline","visible-print-inline-block","w-100"]



class BootstrapCompletions(sublime_plugin.EventListener):
    """
    Provide tag completions for Bootstrap elements and data-uk attributes
    """
    def __init__(self):

        self.class_completions = [("%s \tBootstrap 4 Class" % s, s) for s in bootstrap_classes]

    def on_query_completions(self, view, prefix, locations):

        if view.match_selector(locations[0], "text.html string.quoted"):

            # Cursor is inside a quoted attribute
            # Now check if we are inside the class attribute

            # max search size
            LIMIT  = 250

            # place search cursor one word back
            cursor = locations[0] - len(prefix) - 1

            # dont start with negative value
            start  = max(0, cursor - LIMIT - len(prefix))

            # get part of buffer
            line   = view.substr(sublime.Region(start, cursor))

            # split attributes
            parts  = line.split('=')

            # is the last typed attribute a class attribute?
            if len(parts) > 1 and parts[-2].strip().endswith("class"):
                return self.class_completions
            else:
                return []
        elif view.match_selector(locations[0], "text.html meta.tag - text.html punctuation.definition.tag.begin"):

            # Cursor is in a tag, but not inside an attribute, i.e. <div {here}>
            # This one is easy, just return completions for the data-uk-* attributes
            return self.data_completions

        else:

            return []
